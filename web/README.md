# WebHost


todo:
зафиксировать интерфейс - обязательное поведение хост аппа для взаимодействия с ремоутами.

Жиненный цикл \ хуки

ADD_REMOTES
при загрузке хоста добавляем ленивые модули и их роуты

ADD_REMOTES_DONE
ленивые модули и их роуты добавлены, начинаем сетить конфиги модулей.
добавляются слушатели бас-ивентов из продуктов в формате триггер-действие.

SET_REMOTES_CONFIGS_DONE
слушатели событий из продуктов добавлены,
те что должны быть выполнены как можно раньше (auth) 
как раз цепляются за этот бас-ивент SET_REMOTES_CONFIGS_DONE и выполняются после него.

продукт AU, зарегистрировавший действие
TRIGGER_ACTION - INIT_AUTH_CONFIG,
получает его от хоста и начинает initAuthConfig()
в ходе которого
1. подписывается на AUTH_CONFIG, который должен прийти из нужного места
2. подписывается и сразу запрашивает ROUTER_PATH,
который 
3. определяет, ремоут ли AU, и, если да, то триггреим ASK_AUTH_CONFIG(1)

далее AuthStrategyService достает из инжектора стратегию аутентификации, которую считывает из полученного AUTH_CONFIG и запускает в этой стратегии
runScenario('init')

handleInitScenario()
1. считывает токен из local storage
если токена нет
1.1 SELECT_TOKEN_SHARE_STRATEGY: достаем из AUTH_CONFIG и применяем стратегию расшариваня токена среди ремоутов.
1.2 DISPLAY_LOGIN_FORM: переходим на экран аутентификации.

тем временем TokenShareStrategyService достает из инжектора выбранную стратегию и запускает сценарий runScenario('init')

стратегия SAVE_TEMP_DUPLICATE, init
1. ASK_PROJECTS_IDS: запрашивает идетнификаторы проетов хоста для того, чтобы дождаьбся всех адресов бэка
2. ASK_BACK_URLS: запрашивает адреса бэков у ремоутов. Каждый ремоут зарегстрировал свой ответ на этот event bus hook. Таким образом они отвечают на запрос AU
3. SHARE_TOKEN: Когда все адреса собраны - мы готовы разослать токен, полученный после аутентификации. 

todo:
подписаться на успешный логин в самом начале,
дождаться всех шагов, если они не выполнены 
и разослать токен.

